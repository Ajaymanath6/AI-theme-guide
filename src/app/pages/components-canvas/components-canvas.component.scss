// Components Canvas styles

.canvas-container {
  position: relative;
  min-height: 100%;
  overflow: hidden;
  user-select: none;
  
  // Figma-like grid pattern
  background-image: 
    linear-gradient(rgba(0, 0, 0, 0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0, 0, 0, 0.03) 1px, transparent 1px);
  background-size: 20px 20px;
  background-position: 0 0;
}

// Canvas viewport - pan and zoom wrapper
.canvas-viewport {
  position: absolute;
  width: 5000px; // Large canvas for infinite space
  height: 5000px;
  transition: transform 0.05s linear;
  cursor: grab;
  
  &:active {
    cursor: grabbing;
  }
}

// CDK Drag styles - smooth drag experience like Figma
// Use the original element, not a preview
.cdk-drag-preview {
  display: none !important;
}

.cdk-drag-placeholder {
  display: none !important;
}

.cdk-drag-animating {
  transition: none; // No transition for instant response
}

// Draggable elements - smooth like Figma
.draggable-element {
  cursor: move;
  position: absolute !important;
  will-change: transform;
  opacity: 1 !important;
  visibility: visible !important;
  display: block !important;
  
  &:hover {
    cursor: grab;
  }
  
  &:active {
    cursor: grabbing;
  }
  
  // During drag
  &.cdk-drag-dragging {
    z-index: 1000 !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
  }
}

// Ensure no transitions interfere with smooth drag and elements stay visible
[cdkDrag] {
  transition: none !important;
  opacity: 1 !important;
  visibility: visible !important;
  display: block !important;
  
  &.cdk-drag-dragging {
    transition: none !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
  }
  
  // Make sure element never disappears
  * {
    opacity: 1 !important;
    visibility: visible !important;
  }
}

// ============================================
// Component Tooltip Styles (Refactored)
// ============================================

.component-wrapper {
  position: relative;
  
  // Dim outline glow only when dragging (not on hover)
  &.cdk-drag-dragging > div:not(.component-tooltip),
  &.cdk-drag-dragging > aside,
  &.cdk-drag-dragging > app-sidebar,
  &.cdk-drag-dragging > button,
  &.cdk-drag-dragging > app-super-component {
    outline: 1.5px solid rgba(59, 130, 246, 0.2);
    outline-offset: 3px;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.03);
    transition: outline 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
  }
  
  // Show tooltip on hover
  &:hover .component-tooltip {
    display: block !important;
    opacity: 1 !important;
    visibility: visible !important;
    pointer-events: auto !important;
    transform: translateX(-50%) translateY(calc(100% + 2px));
  }
  
  // Shared component styles
  &.shared-component {
    // Blue outline for shared components - only when dragging
    &.cdk-drag-dragging > div:not(.component-tooltip),
    &.cdk-drag-dragging > aside,
    &.cdk-drag-dragging > app-sidebar,
    &.cdk-drag-dragging > button {
      outline: 1.5px solid rgba(37, 99, 235, 0.2);
      outline-offset: 3px;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.03);
    }
    
    // "SHARED" badge
    &::before {
      content: 'SHARED';
      position: absolute;
      top: -8px;
      left: 8px;
      background: #2563eb;
      color: white;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: 600;
      z-index: 1001;
      pointer-events: none;
    }
  }
  
  // Super component styles
  &.super-component {
    // Purple outline for super components - only when dragging
    &.cdk-drag-dragging > div:not(.component-tooltip),
    &.cdk-drag-dragging > app-super-component {
      outline: 1.5px solid rgba(147, 51, 234, 0.2);
      outline-offset: 3px;
      box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.03);
    }
    
    // Prevent child elements from interfering with drag
    // Only the wrapper should be draggable, children should move with it but not be draggable themselves
    // Disable pointer events on children during drag (handled by CDK)
    pointer-events: auto;
    
    // Prevent text selection during drag
    * {
      user-select: none;
      -webkit-user-select: none;
    }
    
    // Allow buttons to be clickable
    button {
      cursor: pointer;
      pointer-events: auto;
    }
    
    // Ensure only this wrapper is draggable, not nested elements
    &.cdk-drag-dragging {
      // When dragging, prevent child interactions
      * {
        pointer-events: none;
      }
    }
  }
}

.component-tooltip {
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%) translateY(calc(100% + 2px));
  z-index: 1000;
  opacity: 0 !important;
  visibility: hidden !important;
  pointer-events: none !important;
  display: none;
  transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out, visibility 0.2s;
  white-space: nowrap;
  
  // Arrow pointing up
  &::before {
    content: '';
    position: absolute;
    top: -6px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 6px solid rgba(255, 255, 255, 0.95);
  }
}
